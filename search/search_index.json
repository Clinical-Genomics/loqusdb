{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"loqusdb","text":"<p>Software to setup and manage local variant observations database.</p> <p>Right now locusdb uses mongodb as backend for storing variants but it should be doable to adapt the code to another backend.</p> <ul> <li>Installation</li> </ul>"},{"location":"#idea","title":"Idea","text":"<p>To keep track of what variants that have been seen, in what families and what state they  have been observed. This is NOT a tool to create a true frequency database. loqusdb will basically count the number of times we have seen a variant in any individual. Loqusdb will keep track of the variants that have been seen in a homozygous or hemizygous state.</p> <p>It is used both as a live resource that continuously gets filled with new information and can be queried at any time. One could also create a vcf export to annotate new variants.</p> <p>Variants are stored by providing a vcf file and a (ped or ped like)family file.</p> <p>Loqusdb will first check if the vcf file looks ok, then check all variants if they have been observed in any of the individuals in the family.</p>"},{"location":"#how-variants-are-added","title":"How variants are added:","text":"<ul> <li>Either the variant exists, in this case we increase the number of observations with one</li> <li>Or this variant has not ben seen before, then the variant is added to database</li> </ul>"},{"location":"#snvs-and-svs","title":"SNVs and SVs","text":"<p>Previously loqusdb could only handle SNVs and INDELs, from now on it is also capable of handling structural variants. Since structural variants have lower call quality than snvs they need to be regarded as inexact calls. These are therefore grouped into clusters with some extensions, intervals, around the endpoints. The interval size is a function of the size of the SV.</p>"},{"location":"#sample-profiling","title":"Sample profiling","text":"<p>Loqusdb supports profiling of the samples loaded into the database. This is made to prevent the same sample to be loaded into the database more than once. The profiling is made by assessing the genotypes of each sample for a given set of SNPs with high minor allele frequency. If the profile of a sample is too similar to that of an existing sample, the case will not be loaded. </p>"},{"location":"install/","title":"Installation","text":""},{"location":"install/#installation","title":"Installation","text":"<p>Install mongo db</p> <p>then, in a conda environment with Python (&gt;=3.9) do any of these:</p> <p><code>pip install loqusdb</code></p> <p>or</p> <pre><code>$git clone https://github.com/moonso/loqusdb\n$cd loqusdb\n$pip install --editable .\n</code></pre> <p>make sure you have a mongod process running before starting loqusdb</p>"},{"location":"admin-guide/","title":"Admin Guide","text":"<p>Requirements to set up a loqusdb instance connected to a MongoDB database:</p> <ol> <li>Python 3.9+</li> <li>A working instance of MongoDB (no need to create any database in advance)</li> </ol> <p>For instructions on how to install MongoDB consult a tutorial for your operating system.</p> <p>Database can be populated by following the instructions provided in the loading section of the user guide.</p> <ul> <li>Dump database</li> <li>Restore database</li> </ul>"},{"location":"admin-guide/dump/","title":"Dumping a database","text":"<p>Loqus have a command to dump a database to a zipped file.  This command just wraps the mongo command dump with some defaults.</p> <pre><code>$loqusdb dump --help\nUsage: loqusdb dump [OPTIONS]\n\n  Dump the database to a zipped file.\n\n  Default filename is loqusdb.&lt;todays date&gt;.gz (e.g loqusdb.19971004.gz)\n\nOptions:\n  -f, --filename PATH  If custom named file is to be used\n  --help               Show this message and exit.\n</code></pre>"},{"location":"admin-guide/restore/","title":"Restore a database","text":"<p>It is possible to load all information from a dumped loqusdb instance. This command just wraps the mongo command <code>mongo restore</code> Loqusdb is shipped with a database instance that includes structural variants from ~740 1000G individuals. Those have been called with manta, tiddit and CNVnator  and the calls are merged with svdb.  If no file is pointed at <code>loqusdb restore</code> will use this database as default.</p> <pre><code>Usage: loqusdb restore [OPTIONS]\n\n  Restore the database from a zipped file.\n\n  Default is to restore from db dump in loqusdb/resources/\n\nOptions:\n  -f, --filename PATH  If custom named file is to be used\n  --help               Show this message and exit.\n</code></pre>"},{"location":"user-guide/","title":"loqusdb user guide","text":"<p>loqusdb is a tool to store and query snv/indel and sv variants on a large scale. It can be continuously updated with information and queried with positions or regions.</p>"},{"location":"user-guide/#observations","title":"Observations","text":"<p>As mentioned loqusdb is not a frequency database that keeps track of all alleles observed in a population. Instead loqusdb is used to keep track of what variants that have been observed, in what state they where observed and in what individuals or families they where observed. loqusdb was developed to aid in rare variant analysies and therefore information about single variants are extremely important. If for example there is a potentially disease causing variant in a patient we could ask loqusdb if it has been observed before, if loqusdb then tells us that it has been observed in a homozygous state 2 times before we could either exclude the variant or solve 2 more cases.</p>"},{"location":"user-guide/#counting-observations","title":"Counting observations","text":"<p>Variants are only counted once per family, regardless of how many individuals it was observed in. This is to avoid the situation where a large family could have a great impact on a rare variant.</p> <ul> <li>Loading</li> <li>Deleting</li> <li>Exporting</li> <li>Annotating</li> <li>Profiling</li> </ul>"},{"location":"user-guide/annotating/","title":"Annotating variants","text":"<p>Loqusdb can annotate a VCF with observations from an instance.</p> <p>Use command:</p> <pre><code>Usage: loqusdb annotate [OPTIONS] &lt;vcf_file&gt;\n\n  Annotate the variants in a VCF\n\nOptions:\n  --sv\n  --help  Show this message and exit.\n</code></pre>"},{"location":"user-guide/deleting/","title":"Delete a case","text":"<p>When a case is deleted all observations from the case in question will be deleted. Deleting a case is done in the same way as loading a case using the following command:</p> <pre><code>$loqusdb delete &lt;VCF&gt; -f &lt;FAM_file&gt;\n</code></pre>"},{"location":"user-guide/exporting/","title":"Exporting variants","text":"<p>The variant can be exported with observations to the VCF format. This might come to use when annotating variants for analysis of new cases. Since SNVs and SVs differs so much there are two different files for these. Use command:</p> <pre><code>$loqusdb export\n</code></pre> <p>or for SV variants</p> <pre><code>$loqusdb export --variant-type sv\n</code></pre>"},{"location":"user-guide/loading/","title":"Loading a case","text":"<p>Variants are loaded in a case context, this way it becomes possible to trace back where we have observed a variation. VCF files usually does not hold family information, this is why we use a ped file.</p> <p>When loading a case for the first time one could do any of the following:</p> <ol> <li>Load a case with an SNV file</li> <li>Load a case with an SV file</li> <li>Load a case with an SNV file and an SV file</li> </ol> <p>It is possible to add a file after a case is loaded with <code>loqusdb update</code></p> <p>A case is loaded with:</p> <pre><code>$loqusdb load --help\nUsage: loqusdb load [OPTIONS]\n\n  Load the variants of a case\n\n  A variant is loaded if it is observed in any individual of a case If no\n  family file is provided all individuals in vcf file will be considered.\n\nOptions:\n  --variant-file &lt;vcf_file&gt;       Load a VCF with SNV/INDEL Variants\n  --sv-variants &lt;sv_vcf_file&gt;     Load a VCF with Structural Variants\n  -f, --family-file &lt;ped_file&gt;\n  -t, --family-type [ped|alt|cmms|mip]\n                                  If the analysis use one of the known setups,\n                                  please specify which one.  [default: ped]\n  -c, --case-id TEXT              If a different case id than the one in ped\n                                  file should be used\n  -s, --skip-case-id              Do not store case information on variants\n                                  [default: False]\n  --ensure-index                  Make sure that the indexes are in place\n  --gq-threshold INTEGER           Threshold to consider variant  [default: 20]\n  -m, --max-window INTEGER        Specify the maximum window size for svs\n                                  [default: 2000]\n  --check-profile PATH            Apply sample profiling for the samples,\n                                  using the variants in this vcf\n  --hard-threshold FLOAT          profile hamming distance to rejecting load\n                                  (0-1)\n  --soft-threshold FLOAT          profile hamming distance to store similar\n                                  individuals (0-1)\n  --help                          Show this message and exit.\n</code></pre> <p>Loqusdb will check that the individuals in ped file exists in vcf file and then add all the variants to database. If no .ped file is provided when loading a case in loqusdb, then variants for all samples found in the VCF file(s) will be loaded. In this case it will be necessary to provide a case name for this group of samples by using the <code>--case-id</code> option.</p>"},{"location":"user-guide/loading/#command-line-example","title":"Command line example","text":"<p>A few demo files could be used to test a loqusdb instance. They are included in the tests folder, under fixtures.</p> <p>To load all variants for a case by providing both a VCF file containing SNV variants and a VCF file containing SV variants, use the following command:</p> <p><code>loqusdb --uri mongodb://&lt;user&gt;:&lt;password&gt;@&lt;host&gt;:&lt;port&gt; --database &lt;database_name&gt; --load --variant-file tests/fixtures/643594.clinical.vcf.gz --sv-variants tests/fixtures/643594.clinical.SV.vcf --case-id 643594</code></p> <p>where <code>643594</code> in the command above is an arbitrary name assigned to the group of samples present in the VCF file.</p>"},{"location":"user-guide/profiling/","title":"Profile samples","text":"<p>To ensure that there are no sample duplicates in the database, the profiling feature can be used. Profiling of samples is based on a list of SNPs, having a high minor allele frequency (MAF). Each sample loaded into the database will assessed for its genotype on these variant positions. This list of SNPs are chosen and loaded to the database by the user.</p> <p>The user can load a custom set of high MAF SNPs that will be used in profiling.</p> <p>Upon loading a new case, the user choses to activate the profiling feature with the --check-profile option when loading. Here the user provides a VCF file that contains variant calls for each of the predefined high-MAF SNPs. If no call is found for a SNP, the sample will be assumed to be homozygous for the reference allele at this position. The user may define a --hard-threshold, meaning if any existing profile has a similarity greater than this (based on the hamming distance between compared profiles) to any of the loaded samples, the case will not be loaded. Similarly a --soft-threshold can be set, meaning if any similarity greater than this is found, the case may still be loaded, but the similar samples in the database will be stated for the loaded samples. </p> <pre><code>$loqusdb profile --help\nUsage: loqusdb profile [OPTIONS]\n\n  Command for profiling of samples. User may upload variants used in\n  profiling from a vcf, update the profiles for all samples, and get some\n  stats from the profiles in the database.\n\n  Profiling is used to monitor duplicates in the database. The profile is\n  based on the variants in the 'profile_variant' collection, assessing the\n  genotypes for each sample at the position of these variants.\n\nOptions:\n  --variant-file PATH        a vcf containing the SNPs that is used in\n                             profiling\n  --update                   updates the profiles of all the sample in the\n                             database\n  --stats                    Checks some statistics of the profiles in the\n                             database\n  --profile-threshold FLOAT  Used with --stats option to determine the number\n                             of matching profiles with a similarity greater\n                             than given threshold\n  --help                     Show this message and exit.\n\n</code></pre>"}]}